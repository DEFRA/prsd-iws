@using EA.Iws.Core.NotificationAssessment
@using EA.Iws.Core.Shared
@using EnumHelper = EA.Prsd.Core.Helpers.EnumHelper
@using Resource = EA.Iws.Web.Areas.AdminImportAssessment.Views.AccountManagement.IndexResources
@model EA.Iws.Web.Areas.AdminImportAssessment.ViewModels.AccountManagement.AccountManagementViewModel

@{
    ViewBag.Title = Resource.MainHeading;
}

<h1 class="heading-large">@Resource.MainHeading</h1>

<div class="grid-row">

    <div class="column-one-third">
        <p class="bold-xsmall">@Resource.TotalHeading</p>
    </div>

    <div class="column-one-third">
        <p class="bold-xsmall">@Resource.BalanceHeading</p>
    </div>

    <div class="column-one-third">
        <p class="bold-xsmall">@Resource.RemainingHeading</p>
    </div>

</div>

<div class="grid-row">

    <div class="column-one-third bold-medium">
        @Model.TotalCharge.ToString("C")
    </div>

    <div class="column-one-third bold-medium">
        @Model.TotalPaid.ToString("C")
    </div>

    <div class="column-one-third bold-medium">
        @Model.AmountRemaining.ToString("C")
    </div>

</div>

<hr>

<h2 class="heading-medium">@Resource.HistoryHeading</h2>

<div class="form-group">
    <table title=@Resource.HistoryHeading>
        <thead>
        <tr>
            <th>@Resource.TableHeaderTranaction</th>
            <th>@Resource.TableHeaderDate</th>
            <th>@Resource.TableHeaderAmount</th>
            <th>@Resource.TableHeaderType</th>
            <th>@Resource.TableHeaderReceipt</th>
            <th>@Resource.TableHeaderComments</th>
        </tr>
        </thead>
        <tbody>
        @{
            for (var i = 0; i < Model.Transactions.Count(); i++)
            {
                var trans = Model.Transactions[i].Transaction;

                Enum type;
                if (trans == TransactionType.Refund)
                {
                    type = TransactionType.Refund;
                }
                else
                {
                    type = (PaymentMethod)Model.Transactions[i].Type;
                }

                var comment = string.IsNullOrWhiteSpace(Model.Transactions[i].Comments) ? "No" : "<a href=\"#comment-" + i + "\">Yes</a>";

                <tr>
                    <td>@trans</td>
                    <td>@Model.Transactions[i].Date.ToString("dd/MM/yyyy")</td>
                    <td>@Model.Transactions[i].Amount.ToString("C")</td>
                    <td>@EnumHelper.GetDescription(type)</td>
                    <td>@Model.Transactions[i].ReceiptNumber</td>
                    <td>@Html.Raw(comment)</td>
                </tr>
            }
        }
        </tbody>
    </table>
</div>

<div class="form-group">
    <details role="group">

        <summary role="button"><span class="summary">@Resource.CommentSectionHeading</span></summary>

        <div class="panel-border-narrow">

            @for (var i = 0; i < Model.Transactions.Count(); i++)
            {
                if (!string.IsNullOrWhiteSpace(Model.Transactions[i].Comments))
                {
                    var trans = (TransactionType)Model.Transactions[i].Transaction;
                    var commentId = "id=comment-" + i;

                    <span>@trans&nbsp;&nbsp;&nbsp;@Model.Transactions[i].Date.ToString("dd/MM/yyyy")</span>
                    <p @commentId>@Model.Transactions[i].Comments</p>
                }
            }
        </div>

    </details>
</div>

@Html.ActionLink(Resource.KeyDatesLinkText, "Index", "Keydates")

@section menu {
    @Html.Action("ImportNavigation", "Menu", new { area = "Admin", section = ImportNavigationSection.Finance })
}