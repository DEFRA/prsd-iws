IF OBJECT_ID('[Reports].[uspUpdateReportCache]') IS NULL
    EXEC('CREATE PROCEDURE [Reports].[uspUpdateReportCache] AS SET NOCOUNT ON;')
GO

ALTER PROCEDURE [Reports].[uspUpdateReportCache]
AS
BEGIN

    DELETE FROM [Reports].[FreedomOfInformationCache];
    DELETE FROM [Reports].[ShipmentsCache];

    INSERT INTO [Reports].[FreedomOfInformationCache] (
           [NotificationNumber]
          ,[ImportOrExport]
          ,[IsInterim]
          ,[ReceivedDate]
          ,[CompetentAuthorityId]
          ,[NotifierName]
          ,[NotifierAddress]
          ,[NotifierPostalCode]
          ,[ProducerName]
          ,[ProducerAddress]
          ,[ProducerPostalCode]
          ,[PointOfExport]
          ,[PointOfEntry]
          ,[ImportCountryName]
          ,[ChemicalCompositionTypeId]
          ,[NameOfWaste]
          ,[EWC]
          ,[YCode]
          ,[HCode]
          ,[OperationCodes]
          ,[ImporterName]
          ,[ImporterAddress]
          ,[ImporterPostalCode]
          ,[FacilityName]
          ,[FacilityAddress]
          ,[FacilityPostalCode]
          ,[IntendedQuantity]
          ,[IntendedQuantityUnit]
          ,[IntendedQuantityUnitId]
          ,[ConsentFrom]
          ,[ConsentTo]
          ,[LocalArea]
          ,[MovementNumber]
          ,[MovementReceivedDate]
          ,[MovementCompletedDate]
          ,[MovementQuantityReceviedUnitId]
          ,[MovementQuantityReceived]
          ,[BaselOecdCode]
          ,[ExportCountryName]
		  ,[NotifierType]
		  ,[NotifierContactName]
		  ,[NotifierContactEmail]
		  ,[ProducerType]
		  ,[ProducerContactEmail]
		  ,[TransitStates]
		  ,[ImporterType]
		  ,[ImporterContactName]
		  ,[ImporterContactEmail]
		  ,[NotificationStatus]
		  ,[DecisionRequiredByDate]
		  ,[IsFinancialGuaranteeApproved]
		  ,[FileClosedDate]
		  ,[TechnologyEmployed]
		  ,[ActualDate]
		  ,[AcknowledgedDate]
		  ,[ObjectionDate]
		  ,[WithdrawnDate]
		  ,[SiteOfExportName]
		  ,[Officer] )
    SELECT [NotificationNumber]
          ,[ImportOrExport]
          ,[IsInterim]
          ,[ReceivedDate]
          ,[CompetentAuthorityId]
          ,[NotifierName]
          ,[NotifierAddress]
          ,[NotifierPostalCode]
          ,[ProducerName]
          ,[ProducerAddress]
          ,[ProducerPostalCode]
          ,[PointOfExport]
          ,[PointOfEntry]
          ,[ImportCountryName]
          ,[ChemicalCompositionTypeId]
          ,[NameOfWaste]
          ,[EWC]
          ,[YCode]
          ,[HCode]
          ,[OperationCodes]
          ,[ImporterName]
          ,[ImporterAddress]
          ,[ImporterPostalCode]
          ,[FacilityName]
          ,[FacilityAddress]
          ,[FacilityPostalCode]
          ,[IntendedQuantity]
          ,[IntendedQuantityUnit]
          ,[IntendedQuantityUnitId]
          ,[ConsentFrom]
          ,[ConsentTo]
          ,[LocalArea]
          ,[MovementNumber]
          ,[MovementReceivedDate]
          ,[MovementCompletedDate]
          ,[MovementQuantityReceviedUnitId]
          ,[MovementQuantityReceived]
          ,[BaselOecdCode]
          ,[ExportCountryName]
		  ,[NotifierType]
		  ,[NotifierContactName]
		  ,[NotifierContactEmail]
		  ,[ProducerType]
		  ,[ProducerContactEmail]
		  ,[TransitStates]
		  ,[ImporterType]
		  ,[ImporterContactName]
		  ,[ImporterContactEmail]
		  ,[NotificationStatus]
		  ,[DecisionRequiredByDate]
		  ,[IsFinancialGuaranteeApproved]
		  ,[FileClosedDate]
		  ,[TechnologyEmployed]
		  ,[ActualDate]
		  ,[AcknowledgedDate]
		  ,[ObjectionDate]
		  ,[WithdrawnDate]
		  ,[SiteOfExportName]
		  ,[Officer]
      FROM [Reports].[FreedomOfInformation];

    INSERT INTO [Reports].[ShipmentsCache] (
           [NotificationId]
          ,[NotificationNumber]
          ,[CompetentAuthorityId]
          ,[Exporter]
          ,[Importer]
          ,[Facility]
          ,[ShipmentNumber]
          ,[ActualDateOfShipment]
          ,[ConsentFrom]
          ,[ConsentTo]
          ,[PrenotificationDate]
          ,[ReceivedDate]
          ,[CompletedDate]
          ,[QuantityReceived]
          ,[QuantityReceivedUnit]
          ,[QuantityReceivedUnitId]
          ,[ChemicalCompositionTypeId]
          ,[ChemicalComposition]
          ,[LocalArea]
          ,[TotalQuantity]
          ,[TotalQuantityUnits]
          ,[TotalQuantityUnitsId]
          ,[EntryPort]
          ,[DestinationCountry]
          ,[ExitPort]
          ,[OriginatingCountry]
          ,[Status]
          ,[NotificationReceivedDate]
          ,[EwcCodes]
          ,[ImportOrExport]
          ,[BaselOecdCode]
          ,[OperationCodes]
          ,[YCode]
          ,[HCode]
          ,[UNClass]
		  ,[SiteOfExportName]
		  ,[RejectedShipmentDate] )
    SELECT [NotificationId]
          ,[NotificationNumber]
          ,[CompetentAuthorityId]
          ,[Exporter]
          ,[Importer]
          ,[Facility]
          ,[ShipmentNumber]
          ,[ActualDateOfShipment]
          ,[ConsentFrom]
          ,[ConsentTo]
          ,[PrenotificationDate]
          ,[ReceivedDate]
          ,[CompletedDate]
          ,[QuantityReceived]
          ,[QuantityReceivedUnit]
          ,[QuantityReceivedUnitId]
          ,[ChemicalCompositionTypeId]
          ,[ChemicalComposition]
          ,[LocalArea]
          ,[TotalQuantity]
          ,[TotalQuantityUnits]
          ,[TotalQuantityUnitsId]
          ,[EntryPort]
          ,[DestinationCountry]
          ,[ExitPort]
          ,[OriginatingCountry]
          ,[Status]
          ,[NotificationReceivedDate]
          ,[EwcCodes]
          ,[ImportOrExport]
          ,[BaselOecdCode]
          ,[OperationCodes]
          ,[YCode]
          ,[HCode]
          ,[UNClass]
		  ,[SiteOfExportName]
		  ,[RejectedShipmentDate]
      FROM [Reports].[Shipments];

	DELETE FROM [Reports].[ProducerCache];

	INSERT INTO [Reports].[ProducerCache](
			[NotificationNumber] 
			,[CompetentAuthorityId] 
			,[NotifierName] 
			,[ProducerName] 
			,[ProducerAddress1] 
			,[ProducerAddress2] 
			,[ProducerTownOrCity] 
			,[ProducerPostCode] 
			,[SiteOfExport] 
			,[LocalArea] 
			,[WasteType] 
			,[NotificationStatus] 
			,[ConsigneeName] 
			,[ConsentFrom] 
			,[ConsentTo] 
			,[NotificationReceivedDate] 
			,[MovementReceivedDate] 
			,[MovementCompletedDate] 
			,[EwcCode] 
			,[YCode] 
			,[PointOfExit] 
			,[PointOfEntry] 
			,[ExportCountryName] 
			,[ImportCountryName] 
			,[SiteOfExportName] 
			,[FacilityName] )
	SELECT [NotificationNumber] 
			,[CompetentAuthorityId] 
			,[NotifierName] 
			,[ProducerName] 
			,[ProducerAddress1] 
			,[ProducerAddress2] 
			,[ProducerTownOrCity] 
			,[ProducerPostCode] 
			,[SiteOfExport] 
			,[LocalArea] 
			,[WasteType] 
			,[NotificationStatus] 
			,[ConsigneeName] 
			,[ConsentFrom] 
			,[ConsentTo] 
			,[NotificationReceivedDate] 
			,[MovementReceivedDate] 
			,[MovementCompletedDate] 
			,[EwcCode] 
			,[YCode] 
			,[PointOfExit] 
			,[PointOfEntry] 
			,[ExportCountryName] 
			,[ImportCountryName] 
			,[SiteOfExportName] 
			,[FacilityName] 
	FROM [Reports].[Producers]

END
GO